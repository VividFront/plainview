<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "CollectionPage",
    "url": "{{ collection.url }}",
    "name": "{{ collection.title | escape }}",
    "description": "{{ collection.description | strip_html | escape }}",
    "mainEntity": {
      "@type": "ItemList",
      "itemListElement": [
        {%- for product in collection.products -%}
          {
            "@type": "Product",
            "name": "{{ product.title | escape }}",
            "image": [
              {%- for image in product.images -%}
                "{{ image | img_url: 'master' }}"{% unless forloop.last %},{% endunless %}
              {%- endfor -%}
            ],
            "offers": {
              "@type": "Offer",
              "priceCurrency": "{{ shop.currency }}",
              "price": "{{ product.price | money_without_trailing_zeros }}",
              "itemCondition": "http://schema.org/NewCondition",
              "availability": "http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}"
            }
          }{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      ]
    }
  }
</script>
